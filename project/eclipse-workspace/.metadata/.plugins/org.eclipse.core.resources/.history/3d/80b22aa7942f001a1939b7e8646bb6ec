package org.apache.pulsar.io.ignite;

import java.util.Map;

import org.apache.log4j.Logger;
import org.apache.pulsar.functions.api.Record;
import org.apache.pulsar.io.core.KeyValue;
import org.apache.pulsar.io.core.Sink;
import org.apache.pulsar.io.core.SinkContext;

import lombok.extern.java.Log;
import lombok.extern.slf4j.Slf4j;

//override open and write methods of generic sink interface
public abstract class IgniteAbstractSink<K, V> implements Sink<byte[]> {

	private static final Logger LOGGER = Logger.getLogger(IgniteAbstractSink.class);
	private IgniteSinkConfig igniteSinkConfig;
	
	@Override
	public void close() throws Exception {	
	
		LOGGER.info("close Invoked .....");
	}

	@Override
	public void open(Map<String, Object> config, SinkContext sinkContext)
			throws Exception {
		LOGGER.info("open Invoked .....");
		igniteSinkConfig = IgniteSinkConfig.load(config);
		LOGGER.info("igniteSinkConfig:"+igniteSinkConfig.toString());
				
	}

	@Override
	public void write(Record<byte[]> record) throws Exception {
		LOGGER.info("write Invoked .....");	
		KeyValue<K, V> keyValue = extractKeyValue(record);
		LOGGER.info("key:"+keyValue.getKey()+":"+keyValue.getValue());
		
		//logic to wirte into ignite
	}
	
	public abstract KeyValue<K, V> extractKeyValue(Record<byte[]> message);
}
